class Karaoke{constructor(t,e){this.scale=1,this.threshold=30,this.last=0,this.elem=null,this.subtitle=null,this.height=0,this.duration=0,this.isTimestamp=function(t){return t.indexOf("-->")>-1},this.parseTimestamp=function(t){let e=t.split("-->");return{start:e[0].trim(),end:e[1].trim()}},this.parseTimestampMills=function(t){let e=this.parseTimestamp(t),i;return{start:this.convertTimestampToMills(e.start),end:this.convertTimestampToMills(e.end)}},this.convertTimestampToMills=function(t){let e="",i="0";if(t.indexOf(",")>-1){let s=t.split(",");e=s[0],i=s[1]}else if(t.indexOf(".")>-1){let n=t.split(".");e=n[0],i=n[1]}else e=t;let r;return 36e5*this.dmsToDdFromString(e)+parseFloat(i)},this.truncate=function(t){return Math.floor(t)},this.concat=function(t,e){let i=[];return null!=t&&i.push(t),e.length>0&&i.push(e),i.join("\r\n")},this.dToDmsReal=function(t,e,i){(void 0===e||null==e)&&(e=3);let s=Math.abs(t),n=0|s,r=s-n,h=60*r|0,a=3600*r-60*h;return a=a.toFixed(e),i&&(n<10&&(n="0"+n),h<10&&(h="0"+h),a<10&&(a="0"+a)),[n,h,a]},this.ddToDms=function(t){let e=Math.abs(t),i=0|e,s=e-i,n=60*s|0,r=3600*s-60*n;return{d:i,m:n,s:r=Math.round(1e3*r)/1e3}},this.dmsToDd=function(t,e,i){let s=void 0!==t?parseFloat(t):0,n=void 0!==e?parseFloat(e)/60:0,r=void 0!==i?parseFloat(i)/3600:0;return s+n+r},this.dmsToDdFromString=function(t){let e=t.split(":");return this.dmsToDd(e[0],e[1],e[2])},this.ddToDmsSrtFormat=function(t){let e=this.ddToDms(t),i=e.d,s=e.m,n=e.s.toFixed(3);return i<10&&(i="0"+i),s<10&&(s="0"+s),n<10&&(n="0"+n),i+":"+s+":"+n.replace(".",",")},this.parseFloat=function(t){return null==t||"string"!=typeof t?t:t.length>0?""==(t=t.replace(/[^.\d]/g,""))?0:Number(t):0},this.msToUnit=function(t){return t*this.scale*this.zoom},this.unitToMs=function(t){return t/(this.scale*this.zoom)},this.createData=function(t,e){if(t){let i=this.parseTimestampMills(t),s=i.start,n=i.end;return{start:s,end:n,duration:n-s,text:e}}return{start:0,end:0,duration:0,text:e}},this.getMinimumDuration=function(t){let e=-1;for(let i in t.data)(e>t.data[i].duration||-1==e)&&(e=t.data[i].duration);return e},this.parseRawData=function(t){let e=(t=t.trim().replace(/\r?\n/g,"\r\n")).split(/\n/g),i=-1,s=[],n=0;for(let r=0;r<e.length;r++)e[r]=e[r].trim(),this.isTimestamp(e[r])?s[++i]=this.createData(e[r]):(i>-1&&(s[i].text=this.concat(s[i].text,e[r])),n++);return void 0===s[i].text&&(s[i].text=""),{data:s,nonempty:n,totalLength:e.length}},this.renderPrompt=function(t,e){this.subtitle=t;let i=document.querySelector(e);this.elem=i;let s=this.getMinimumDuration(t);for(let n in this.scale=32/s,i.innerHTML="",t.data){let r=t.data[n].duration,h=t.data[n].start,a=this.scale*r,l=this.scale*h,o=document.createElement("div");o.style.height=Math.round(a)+"px",o.style.top=Math.round(l)+"px",o.innerText=t.data[n].text,o.setAttribute("data-index",n),i.appendChild(o)}i.style.height=this.scale*this.duration+"px"},this.getIndex=function(t){for(let e in this.subtitle.data)if(this.subtitle.data[e].start<=t&&this.subtitle.data[e].end>=t)return parseInt(e);return -1},this.animate=function(){let t=new Date().getTime();if(t-this.last>=this.threshold){this.height=this.elem.parentNode.offsetHeight;let e=t-this.getStart(),i=this.height/4-e*this.scale,s=this.getIndex(e);this.markSelected(s),this.elem.style.top=i+"px",this.last=t}},this.updatePosition=function(t,e){e=e||0,this.height=this.elem.parentNode.offsetHeight;let i=this.height/4-t*this.scale,s=this.getIndex(t);this.markSelected(s),this.elem.style.top=e+i+"px"},this.readStored=!1,this.offsetStored=0,this.getStart=function(){if(this.readStored)return this.offsetStored;{let t=localStorage.getItem("offset_"+this.songId);if(void 0===t||null==t)return this.start;{""==(t=t.replace(/[^0-9.]/g,""))&&(t="0");let e=parseInt(t);return 0==e?this.start:(this.offsetStored=e,this.readStored=!0,e)}}},this.markSelected=function(t){this.lastSelected!=t&&(-1==t?this.cleanup():this.markup(t)),this.lastSelected=t},this.cleanup=function(){let t=this.elem.childNodes.length;for(let e=0;e<t;e++)this.elem.childNodes[e].classList.remove("marked")},this.markup=function(t){this.cleanup(),this.elem.childNodes[t].classList.add("marked")},this.lastSelected=-1,this.songId="",this.init=function(t,e){this.start=t.start,this.songId=t.song_id,this.duration=t.duration;let i=this.parseRawData(t.subtitle);this.subtitle=i,this.renderPrompt(i,e)},this.init(t,e)}}