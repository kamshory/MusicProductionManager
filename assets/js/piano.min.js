class Piano{constructor(t){this.factor=16,this.min=12,this.max=133,this.element=t,this.time=0,this.inf=[{type:1,offset:0,width:1},{type:2,offset:.5,width:.8},{type:1,offset:1,width:1},{type:2,offset:1.7,width:.8},{type:1,offset:2,width:1},{type:1,offset:3,width:1},{type:2,offset:3.5,width:.8},{type:1,offset:4,width:1},{type:2,offset:4.6,width:.8},{type:1,offset:5,width:1},{type:2,offset:5.7,width:.8},{type:1,offset:6,width:1},],this.song=[],this.setDuration=function(){for(let t in this.song)this.song[t].duration=this.song[t].end-this.song[t].start},this.setSong=function(t){this.song=t;let e=127,i=0;for(let s in this.song){let n=this.song[s].note;n<e&&(e=n),n>i&&(i=n)}this.min=e-e%12,this.max=12+i-i%12,this.max-this.min<=24?this.factor=20:this.factor=14,this.createPiano()},this.setTime=function(t){this.time=t},this.getNotes=function(t){let e=[];for(let i in this.song)this.song[i].start<=t&&this.song[i].end>=t&&e.push(this.song[i]);return e},this.draw=function(){let t=this.getNotes(this.time);this.clearTuts();for(let e of(this.element.querySelector(".lyric-container").innerHTML="",t))this.setNoteOn(e)},this.init=function(t){this.elem=t},this.clearTuts=function(){let t=this.element.querySelectorAll(".piano-tuts");for(let e of t)e.classList.remove("note-on")},this.setNoteOn=function(t){let e=this.element.querySelector(".lyric-container"),i=this.element.querySelector('.piano-tuts[data-index="'+t.note+'"]');if(null!=i){i.classList.add("note-on");let s=document.createElement("div"),n=i.offsetLeft-25;n+=i.offsetWidth/2,s.style.left=n+"px",s.classList.add("lyric-item"),s.innerHTML=t.lyric,e.appendChild(s)}},this.calculateWidth=function(){let t=this.element.querySelectorAll(".piano-tuts.piano-tuts-white");return this.factor*t.length},this.createPiano=function(){let t=this.factor,e=this.min,i=this.max,s=71*t;this.tutsWidth=s,this.element.innerHTML="",this.element.style.width=s+"px";let n=document.createElement("div");this.element.appendChild(n),n.classList.add("lyric-container");let l=document.createElement("div");this.element.appendChild(l),l.classList.add("piano-inner");let h=document.createElement("div");this.element.appendChild(h),h.classList.add("piano-octave");for(let o=e;o<i;o++){let a=document.createElement("div"),f=o%12,r=Math.floor((o-e)/12),d=this.inf[f];1==d.type&&(a.className="piano-tuts piano-tuts-white",a.setAttribute("data-index",o),a.style.left=7*r*t+d.offset*t+0+"px",a.style.width=d.width*t+"px",l.appendChild(a))}for(let c=e;c<i;c++){let p=document.createElement("div"),m=c%12,u=Math.floor((c-e)/12),y=this.inf[m];2==y.type&&(p.className="piano-tuts piano-tuts-black",p.setAttribute("data-index",c),p.style.left=7*u*t+y.offset*t+0+"px",p.style.width=y.width*t+"px",l.appendChild(p))}let _=this.min/12,w=this.max/12,x=0;for(let g=_;g<w;g++){let $=document.createElement("div");$.classList.add("octave-marker"),$.style.width=7*this.factor-1+"px",$.style.left=x-0+"px",$.innerText="Octave "+g,h.appendChild($),x+=7*this.factor}let v=this.calculateWidth();this.elem.style.width=v+"px"},this.init(t)}}