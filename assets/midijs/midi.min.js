var ctx;!function(e){function n(e,n){for(let t=0;t<document.scripts.length;t++)if(A==document.scripts[t].src){if(F)return void n();let r=newjs.onload;newjs.onreadystatechange=function(){("loaded"==newjs.readyState||"complete"==newjs.readyState)&&(newjs.onreadystatechange=null,F=!0,r(),n())},newjs.onload=function(){F=!0,r(),n()}}let o=document.getElementsByTagName("script")[0];(newjs=document.createElement("script")).onreadystatechange=function(){("loaded"==newjs.readyState||"complete"==newjs.readyState)&&(newjs.onreadystatechange=null,F=!0,n())},newjs.onload=function(){F=!0,n()},newjs.onerror=function(){_("Error: Cannot load  JavaScript file "+e)},newjs.src=e,newjs.type="text/javascript",o.parentNode.insertBefore(newjs,o)}function t(e){if(0==(T=Module.ccall("mid_song_read_wave","number",["number","number","number","number"],[S,h,2*P,L])))return void I();let n=[];for(let t=0;t<P;t++)t<T?e.outputBuffer.getChannelData(0)[t]=n[t]=Module.getValue(h+2*t,"i16")/32768:e.outputBuffer.getChannelData(0)[t]=n[t]=0;er=n,0==V&&(V=O.currentTime)}function r(){e.MIDIjs.visualization(er),R?requestAnimationFrame(r):en=!1}function o(e,n,r){let o=new XMLHttpRequest;o.open("GET",n+r,!0),o.responseType="arraybuffer",o.onerror=function(){_("Error: Cannot retrieve patch file "+n+r)},o.onload=function(){if(200!=o.status)return void _("Error: Cannot retrieve patch file "+n+r+" : "+o.status);if(k--,FS.createDataFile("pat/",r,new Int8Array(o.response),!0,!0),MIDIjs.message_callback&&k>0&&(MIDIjs.message_callback("Loading Instruments: "+k),_("Loading Instruments: "+k)),0==k){let i=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[x,v.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[O.sampleRate,32784,1,2*P]);S=Module.ccall("mid_song_load","number",["number","number"],[i,s]),Module.ccall("mid_istream_close","number",["number"],[i]),Module.ccall("mid_song_start","void",["number"],[S]),w=O.createScriptProcessor(P,0,1),h=Module._malloc(2*P),w.onaudioprocess=t,w.connect(O.destination),clearInterval(E),E=setInterval(a,z),MIDIjs.message_callback&&MIDIjs.message_callback("Playing MIDI"),_("Playing: "+e+" ...")}},o.send()}function i(e){let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onerror=function(){_("Error: Cannot preload file "+e)},n.onload=function(){if(200!=n.status)return void _("Error: Cannot preload file "+e+" : "+n.status)},n.send()}function a(){let n={};n.audioMethod=e.MIDIjs.data.audioMethod,n.isPlaying=R,n.duration=e.MIDIjs.data.duration,0!=V?n.time=O.currentTime-V:n.time=0,n.time>n.duration&&n.duration>1&&(b(),e.MIDIjs.on_ended()),MIDIjs.player_callback&&MIDIjs.player_callback(n)}function s(){let n={};n.audioMethod=e.MIDIjs.data.audioMethod,n.isPlaying=R,n.duration=e.MIDIjs.data.duration,0==V&&(V=(new Date).getTime()),n.time=((new Date).getTime()-V)/1e3,MIDIjs.player_callback&&MIDIjs.player_callback(n)}function u(){if(R=!0,MIDIjs.message_callback("Playing MIDI"),en||(r(),en=!0),O&&O.resume)return O.resume()}function l(e){O||(window.AudioContext=window.AudioContext||window.webkitAudioContext,O=new AudioContext),O.resume?O.resume().then(c(e)):c(e)}function c(e){V=0,a(),_("Loading libtimidity ... "),n(A,function(){d(e,m,null)}),G=O.createBuffer(2,3*O.sampleRate,O.sampleRate),(H=O.createBufferSource()).buffer=G,H.connect(O.destination)}function d(e,n,t){if(-1!=e.indexOf("data:")){let r=e.indexOf(",")+1,o=atob(e.substring(r));v=new Uint8Array(new ArrayBuffer(o.length));for(let i=0;i<o.length;i++)v[i]=o.charCodeAt(i);return n("data:audio/x-midi ...",v,t)}_("Loading MIDI file "+e+" ..."),t||MIDIjs.message_callback("Loading MIDI");let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onerror=function(){_("Error: Cannot retrieve MIDI file "+e)},a.onload=function(){return 200!=a.status?void _("Error: Cannot retrieve MIDI file "+e+" : "+a.status):(_("MIDI file loaded: "+e),n(e,v=new Int8Array(a.response),t))},a.send()}function m(e,n,r){x=Module._malloc(n.length),Module.writeArrayToMemory(n,x);let i=Module.ccall("mid_init","number",[],[]),s=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[x,n.length,!1]),u=Module.ccall("mid_create_options","number",["number","number","number","number"],[O.sampleRate,32784,1,2*P]);if(S=Module.ccall("mid_song_load","number",["number","number"],[s,u]),i=Module.ccall("mid_istream_close","number",["number"],[s]),0<(k=Module.ccall("mid_song_get_num_missing_instruments","number",["number"],[S])))for(let l=0;l<k;l++)o(e,N+"pat/",Module.ccall("mid_song_get_missing_instrument","string",["number","number"],[S,l]));else Module.ccall("mid_song_start","void",["number"],[S]),w=O.createScriptProcessor(P,0,1),h=Module._malloc(2*P),w.onaudioprocess=t,w.connect(O.destination),clearInterval(E),E=setInterval(a,z),MIDIjs.message_callback&&MIDIjs.message_callback("Playing MIDI"),_("Playing: "+e+" ...");f(e,n,r)}function f(n,t,r){let o=Module._malloc(t.length);Module.writeArrayToMemory(t,o);let i=(Module.ccall("mid_init","number",[],[]),Module.ccall("mid_istream_open_mem","number",["number","number","number"],[o,t.length,!1])),a=Module.ccall("mid_create_options","number",["number","number","number","number"],[44100,32784,1,2*P]),s=Module.ccall("mid_song_load","number",["number","number"],[i,a]),u=(Module.ccall("mid_istream_close","number",["number"],[i]),Module.ccall("mid_song_get_total_time","number",["number"],[s])/1e3);e.MIDIjs.data.duration=u,e.MIDIjs.on_song_loaded(i,32784,a,s,u),Module.ccall("mid_song_free","void",["number"],[s]),Module._free(o),r&&r(u)}function I(){w&&(w.disconnect(),w.onaudioprocess=0,w=0),S&&(Module._free(h),Module._free(x),Module.ccall("mid_song_free","void",["number"],[S]),S=0)}function b(){R=!1,MIDIjs.message_callback("Stoped"),I(),clearInterval(E),_(B)}function p(e){var n;return -1!=e.indexOf("http:")?e:(n=e,void 0===C&&(C=document.createElement("a")),C.href=n,C.href).replace("https:","http:")}function g(e){M();let n=p(e),t=document.getElementById("planetMIDI");t?t.lastChild.setAttribute("src",n):((t=document.createElement("div")).setAttribute("id","planetMIDI"),t.innerHTML='&nbsp;<bgsound src="'+n+'" volume="0"/>',document.body&&document.body.appendChild(t)),clearInterval(E),E=setInterval(s,z),V=0,w=t,_("Playing "+n+" ...")}function M(){w&&(w.lastChild.setAttribute("src",p(N)+"silence.mid"),clearInterval(E),w=0),_(B)}function $(){if(w){let e=w;e.parentNode.removeChild(e),clearInterval(E),w=0}_(B)}function D(){return H}function j(){return O}function _(e){W&&console.log(e)}try{e.MIDIjs={},e.MIDIjs.data={},e.MIDIjs.initError="initializing ...";var y,h,x,v,A,C,E,O=null,w=0,P=8192,k=0,T=0,S=0,N="",V=0,B="",L=!1,R=!1,W=!1,z=10,F=!1,G=null,H=null;A=(N=function e(){for(let n=0;n<document.scripts.length;n++){let t=document.scripts[n].src;if(t.lastIndexOf("/midi.min.js")>-1){let r=t.split("/");return r.pop(),r.join("/")+"/"}}for(let o=0;o<document.scripts.length;o++){let i=document.scripts[o].src;if(i.lastIndexOf("/midi.js")>-1){let a=i.split("/");return a.pop(),a.join("/")+"/"}}return null}())+"libtimidity.min.js";let J,U,q,K,Q,X,Y,Z;var ee=(K=navigator.userAgent,Q=navigator.appName,X=""+parseFloat(navigator.appVersion),Y=parseInt(navigator.appVersion,10),-1!=K.indexOf("Opera")?(Q="Opera",X=K.substring(U+6),-1!=K.indexOf("Version")&&(X=K.substring(U+8))):-1!=K.indexOf("MSIE")?(Q="Microsoft Internet Explorer",X=K.substring(U+5)):-1!=K.indexOf("Trident")?(Q="Microsoft Internet Explorer",X=-1!=K.indexOf("rv:")?K.substring(U+3):"0.0"):-1!=K.indexOf("Chrome")?(Q="Chrome",X=K.substring(U+7)):-1!=K.indexOf("Android")?(Q="Android",X=K.substring(U+8)):-1!=K.indexOf("Safari")?(Q="Safari",X=K.substring(U+7),-1!=K.indexOf("Version")&&(X=K.substring(U+8))):-1!=K.indexOf("Firefox")?(Q="Firefox",X=K.substring(U+8)):K.lastIndexOf(" ")+1<K.lastIndexOf("/")&&(J=K.lastIndexOf(" ")+1,Q=K.substring(U,J),X=K.substring(U+1),Q.toLowerCase()==Q.toUpperCase()&&(Q=navigator.appName,-1!=(q=X.indexOf(";"))&&(X=X.substring(0,q)),-1!=(q=X.indexOf(" "))&&(X=X.substring(0,q)),-1!=(q=X.indexOf(")"))&&(X=X.substring(0,q)),isNaN(Y=parseInt(""+X,10))&&(X=""+parseFloat(navigator.appVersion)),Y=parseInt(navigator.appVersion,10))),(Z={}).browserName=Q,Z.fullVersion=X,Z.majorVersion=Y,Z.appName=navigator.appName,Z.userAgent=navigator.userAgent,Z.platform=navigator.platform,Z),en=!1;try{("iPhone"==ee.platform||"iPod"==ee.platform||"iPad"==ee.platform)&&ee.majorVersion<=6?y="none":(window.AudioContext=window.AudioContext||window.webkitAudioContext,O=new AudioContext,y="WebAudioAPI")}catch(et){y="Microsoft Internet Explorer"==ee.browserName?"bgsound":"Android"==ee.browserName?"none":"object"}e.MIDIjs.data.duration=0,e.MIDIjs.data.audioMethod=y,e.MIDIjs.setPlayingTime=function(){},e.MIDIjs.getAudioContext=function(){},e.MIDIjs.on_ended,e.MIDIjs.set_logging=function(e){W=e},e.MIDIjs.get_loggging=function(){return W},e.MIDIjs.player_callback=function(e){},e.MIDIjs.message_callback=function(e){},e.MIDIjs.get_audio_status=function(){return B},e.MIDIjs.getSource=function(){},e.MIDIjs.visualization=function(e){},e.MIDIjs.get_duration=function(e,t){"Microsoft Internet Explorer"==ee.browserName&&ee.fullVersion<10?t&&t(-1):n(A,function(){d(e,f,t)})},e.MIDIjs.pause=function(){},e.MIDIjs.resume=function(){},e.MIDIjs.resumeWebAudioContext=function(){},e.MIDIjs.on_song_loaded=function(){},"WebAudioAPI"==y?(e.MIDIjs.resumeWebAudioContext=u,e.MIDIjs.pause=function e(){R=!1,en=!1,MIDIjs.message_callback("Paused"),O&&O.suspend()},e.MIDIjs.resume=u,e.MIDIjs.play=function n(t){b(),L=!1,R=!0,P=8192,l(t),e.MIDIjs.data.duration>1&&(clearInterval(E),E=setInterval(a,z)),en||(r(),en=!0)},e.MIDIjs.stop=b,e.MIDIjs.setPlayingTime=function e(n,t,r){},e.MIDIjs.getAudioContext=j,B="audioMethod: WebAudioAPI, sampleRate (Hz): "+O.sampleRate+", audioBufferSize (Byte): "+P,e.MIDIjs.noteOn=function e(n,t,r){L||(sPlaying=!0,P=512,l(N+"initsynth.midi")),0!=S&&Module.ccall("mid_song_note_on","void",["number","number","number","number"],[S,n,t,r])},e.MIDIjs.startSynth=function e(){MIDIjs.noteOn(0,60,0)},e.MIDIjs.seek=function e(n){Module.ccall("skip_to","void",["number","number"],[S,n*O.sampleRate]),V=O.currentTime-n},e.MIDIjs.getSource=D):"bgsound"==y?(e.MIDIjs.play=g,e.MIDIjs.stop=M,B="audioMethod: &lt;bgsound&gt;"):"object"==y?(e.MIDIjs.play=function e(n){$();let t=document.getElementById("planetMIDI");t?t.lastChild.setAttribute("data",n):((t=document.createElement("div")).setAttribute("id","planetMIDI"),t.innerHTML='<object data="'+n+'" autostart="true" volume="0" type="audio/mid"></object>',document.body&&document.body.appendChild(t),clearInterval(E),E=setInterval(s,z),V=0,w=t,_("Playing "+n+" ..."))},e.MIDIjs.stop=$,B="audioMethod: &lt;object&gt;"):(e.MIDIjs.play=function(e){},e.MIDIjs.stop=function(e){},B="audioMethod: No method found","Microsoft Internet Explorer"==ee.browserName&&"https:"==location.protocol.toLowerCase()&&setTimeout(function(){g(p(N)+"silence.mid"),clearInterval(E)},1)),ctx=O;var er={};(-1==location.href.indexOf("local")||"WebAudioAPI"==y)&&(i(N+"pat/arachno-127.pat"),i(N+"pat/MT32Drums/mt32drum-41.pat"),i(A)),e.MIDIjs.initError=null}catch(eo){e.MIDIjs={},e.MIDIjs.initError=eo}}(this);