var ctx;!function(e){function n(e,n){for(let t=0;t<document.scripts.length;t++)if(x==document.scripts[t].src){if(z)return void n();let r=newjs.onload;newjs.onreadystatechange=function(){("loaded"==newjs.readyState||"complete"==newjs.readyState)&&(newjs.onreadystatechange=null,z=!0,r(),n())},newjs.onload=function(){z=!0,r(),n()}}let o=document.getElementsByTagName("script")[0];(newjs=document.createElement("script")).onreadystatechange=function(){("loaded"==newjs.readyState||"complete"==newjs.readyState)&&(newjs.onreadystatechange=null,z=!0,n())},newjs.onload=function(){z=!0,n()},newjs.onerror=function(){D("Error: Cannot load  JavaScript file "+e)},newjs.src=e,newjs.type="text/javascript",o.parentNode.insertBefore(newjs,o)}function t(e){if(0==(k=Module.ccall("mid_song_read_wave","number",["number","number","number","number"],[P,j,2*O,V])))return void I();let n=[];for(let t=0;t<O;t++)t<k?e.outputBuffer.getChannelData(0)[t]=n[t]=Module.getValue(j+2*t,"i16")/32768:e.outputBuffer.getChannelData(0)[t]=n[t]=0;Z=n,0==N&&(N=C.currentTime)}function r(){e.MIDIjs.visualization(Z),L?requestAnimationFrame(r):X=!1}function o(e,n,r){let o=new XMLHttpRequest;o.open("GET",n+r,!0),o.responseType="arraybuffer",o.onerror=function(){D("Error: Cannot retrieve patch file "+n+r)},o.onload=function(){if(200!=o.status)return void D("Error: Cannot retrieve patch file "+n+r+" : "+o.status);if(w--,FS.createDataFile("pat/",r,new Int8Array(o.response),!0,!0),MIDIjs.message_callback&&w>0&&(MIDIjs.message_callback("Loading Instruments: "+w),D("Loading Instruments: "+w)),0==w){let i=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[y,h.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[C.sampleRate,32784,1,2*O]);P=Module.ccall("mid_song_load","number",["number","number"],[i,s]),Module.ccall("mid_istream_close","number",["number"],[i]),Module.ccall("mid_song_start","void",["number"],[P]),E=C.createScriptProcessor(O,0,1),j=Module._malloc(2*O),E.onaudioprocess=t,E.connect(C.destination),clearInterval(A),A=setInterval(a,W),MIDIjs.message_callback&&MIDIjs.message_callback("Playing MIDI"),D("Playing: "+e+" ...")}},o.send()}function i(e){let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onerror=function(){D("Error: Cannot preload file "+e)},n.onload=function(){if(200!=n.status)return void D("Error: Cannot preload file "+e+" : "+n.status)},n.send()}function a(){let n={};n.audioMethod=e.MIDIjs.data.audioMethod,n.isPlaying=L,n.duration=e.MIDIjs.data.duration,0!=N?n.time=C.currentTime-N:n.time=0,n.time>n.duration&&n.duration>1&&(b(),e.MIDIjs.on_ended()),MIDIjs.player_callback&&MIDIjs.player_callback(n)}function s(){let n={};n.audioMethod=e.MIDIjs.data.audioMethod,n.isPlaying=L,n.duration=e.MIDIjs.data.duration,0==N&&(N=(new Date).getTime()),n.time=((new Date).getTime()-N)/1e3,MIDIjs.player_callback&&MIDIjs.player_callback(n)}function u(){if(L=!0,MIDIjs.message_callback("Playing MIDI"),X||(r(),X=!0),C&&C.resume)return C.resume()}function l(e){C||(window.AudioContext=window.AudioContext||window.webkitAudioContext,C=new AudioContext),C.resume?C.resume().then(c(e)):c(e)}function c(e){N=0,a(),D("Loading libtimidity ... "),n(x,function(){d(e,m,null)})}function d(e,n,t){if(-1!=e.indexOf("data:")){let r=e.indexOf(",")+1,o=atob(e.substring(r));h=new Uint8Array(new ArrayBuffer(o.length));for(let i=0;i<o.length;i++)h[i]=o.charCodeAt(i);return n("data:audio/x-midi ...",h,t)}D("Loading MIDI file "+e+" ..."),t||MIDIjs.message_callback("Loading MIDI");let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onerror=function(){D("Error: Cannot retrieve MIDI file "+e)},a.onload=function(){return 200!=a.status?void D("Error: Cannot retrieve MIDI file "+e+" : "+a.status):(D("MIDI file loaded: "+e),n(e,h=new Int8Array(a.response),t))},a.send()}function m(e,n,r){y=Module._malloc(n.length),Module.writeArrayToMemory(n,y),rval=Module.ccall("mid_init","number",[],[]);let i=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[y,n.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[C.sampleRate,32784,1,2*O]);if(P=Module.ccall("mid_song_load","number",["number","number"],[i,s]),rval=Module.ccall("mid_istream_close","number",["number"],[i]),0<(w=Module.ccall("mid_song_get_num_missing_instruments","number",["number"],[P])))for(let u=0;u<w;u++)o(e,T+"pat/",Module.ccall("mid_song_get_missing_instrument","string",["number","number"],[P,u]));else Module.ccall("mid_song_start","void",["number"],[P]),E=C.createScriptProcessor(O,0,1),j=Module._malloc(2*O),E.onaudioprocess=t,E.connect(C.destination),clearInterval(A),A=setInterval(a,W),MIDIjs.message_callback&&MIDIjs.message_callback("Playing MIDI"),D("Playing: "+e+" ...");f(e,n,r)}function f(n,t,r){let o=Module._malloc(t.length);Module.writeArrayToMemory(t,o);let i=(Module.ccall("mid_init","number",[],[]),Module.ccall("mid_istream_open_mem","number",["number","number","number"],[o,t.length,!1])),a=Module.ccall("mid_create_options","number",["number","number","number","number"],[44100,32784,1,2*O]),s=Module.ccall("mid_song_load","number",["number","number"],[i,a]),u=(Module.ccall("mid_istream_close","number",["number"],[i]),Module.ccall("mid_song_get_total_time","number",["number"],[s])/1e3);e.MIDIjs.data.duration=u,e.MIDIjs.on_song_loaded(i,32784,a,s,u),Module.ccall("mid_song_free","void",["number"],[s]),Module._free(o),r&&r(u)}function I(){E&&(E.disconnect(),E.onaudioprocess=0,E=0),P&&(Module._free(j),Module._free(y),Module.ccall("mid_song_free","void",["number"],[P]),P=0)}function b(){L=!1,MIDIjs.message_callback("Stoped"),I(),clearInterval(A),D(S)}function p(e){var n;return -1!=e.indexOf("http:")?e:(n=e,void 0===v&&(v=document.createElement("a")),v.href=n,v.href).replace("https:","http:")}function g(e){$();let n=p(e),t=document.getElementById("planetMIDI");t?t.lastChild.setAttribute("src",n):((t=document.createElement("div")).setAttribute("id","planetMIDI"),t.innerHTML='&nbsp;<bgsound src="'+n+'" volume="0"/>',document.body&&document.body.appendChild(t)),clearInterval(A),A=setInterval(s,W),N=0,E=t,D("Playing "+n+" ...")}function $(){E&&(E.lastChild.setAttribute("src",p(T)+"silence.mid"),clearInterval(A),E=0),D(S)}function M(){if(E){let e=E;e.parentNode.removeChild(e),clearInterval(A),E=0}D(S)}function D(e){B&&console.log(e)}try{e.MIDIjs={},e.MIDIjs.data={},e.MIDIjs.initError="initializing ...";var _,j,y,h,x,v,A,C=null,E=0,O=8192,w=0,k=0,P=0,T="",N=0,S="",V=!1,L=!1,B=!1,W=10,z=!1;x=(T=function e(){for(let n=0;n<document.scripts.length;n++){let t=document.scripts[n].src;if(t.lastIndexOf("/midi.min.js")>-1){let r=t.split("/");return r.pop(),r.join("/")+"/"}}return null}())+"libtimidity.min.js";let R,F,G,H,J,U,q,K;var Q=(H=navigator.userAgent,J=navigator.appName,U=""+parseFloat(navigator.appVersion),q=parseInt(navigator.appVersion,10),-1!=H.indexOf("Opera")?(J="Opera",U=H.substring(F+6),-1!=H.indexOf("Version")&&(U=H.substring(F+8))):-1!=H.indexOf("MSIE")?(J="Microsoft Internet Explorer",U=H.substring(F+5)):-1!=H.indexOf("Trident")?(J="Microsoft Internet Explorer",U=-1!=H.indexOf("rv:")?H.substring(F+3):"0.0"):-1!=H.indexOf("Chrome")?(J="Chrome",U=H.substring(F+7)):-1!=H.indexOf("Android")?(J="Android",U=H.substring(F+8)):-1!=H.indexOf("Safari")?(J="Safari",U=H.substring(F+7),-1!=H.indexOf("Version")&&(U=H.substring(F+8))):-1!=H.indexOf("Firefox")?(J="Firefox",U=H.substring(F+8)):H.lastIndexOf(" ")+1<H.lastIndexOf("/")&&(R=H.lastIndexOf(" ")+1,J=H.substring(F,R),U=H.substring(F+1),J.toLowerCase()==J.toUpperCase()&&(J=navigator.appName,-1!=(G=U.indexOf(";"))&&(U=U.substring(0,G)),-1!=(G=U.indexOf(" "))&&(U=U.substring(0,G)),-1!=(G=U.indexOf(")"))&&(U=U.substring(0,G)),isNaN(q=parseInt(""+U,10))&&(U=""+parseFloat(navigator.appVersion)),q=parseInt(navigator.appVersion,10))),(K={}).browserName=J,K.fullVersion=U,K.majorVersion=q,K.appName=navigator.appName,K.userAgent=navigator.userAgent,K.platform=navigator.platform,K),X=!1;try{("iPhone"==Q.platform||"iPod"==Q.platform||"iPad"==Q.platform)&&Q.majorVersion<=6?_="none":(window.AudioContext=window.AudioContext||window.webkitAudioContext,C=new AudioContext,_="WebAudioAPI")}catch(Y){_="Microsoft Internet Explorer"==Q.browserName?"bgsound":"Android"==Q.browserName?"none":"object"}e.MIDIjs.data.duration=0,e.MIDIjs.data.audioMethod=_,e.MIDIjs.set_playing_time=function(){},e.MIDIjs.on_ended,e.MIDIjs.set_logging=function(e){B=e},e.MIDIjs.get_loggging=function(){return B},e.MIDIjs.player_callback=function(e){},e.MIDIjs.message_callback=function(e){},e.MIDIjs.get_audio_status=function(){return S},e.MIDIjs.visualization=function(e){},e.MIDIjs.get_duration=function(e,t){"Microsoft Internet Explorer"==Q.browserName&&Q.fullVersion<10?t&&t(-1):n(x,function(){d(e,f,t)})},e.MIDIjs.pause=function(){},e.MIDIjs.resume=function(){},e.MIDIjs.resumeWebAudioContext=function(){},e.MIDIjs.on_song_loaded=function(){},"WebAudioAPI"==_?(e.MIDIjs.resumeWebAudioContext=u,e.MIDIjs.pause=function e(){L=!1,X=!1,MIDIjs.message_callback("Paused"),C&&C.suspend()},e.MIDIjs.resume=u,e.MIDIjs.play=function n(t){b(),V=!1,L=!0,O=8192,l(t),e.MIDIjs.data.duration>1&&(clearInterval(A),A=setInterval(a,W)),X||(r(),X=!0)},e.MIDIjs.stop=b,e.MIDIjs.set_playing_time=function e(n,t,r){},S="audioMethod: WebAudioAPI, sampleRate (Hz): "+C.sampleRate+", audioBufferSize (Byte): "+O,e.MIDIjs.noteOn=function e(n,t,r){V||(sPlaying=!0,O=512,l(T+"initsynth.midi")),0!=P&&Module.ccall("mid_song_note_on","void",["number","number","number","number"],[P,n,t,r])},e.MIDIjs.startSynth=function e(){MIDIjs.noteOn(0,60,0)},e.MIDIjs.seek=function e(n){}):"bgsound"==_?(e.MIDIjs.play=g,e.MIDIjs.stop=$,S="audioMethod: &lt;bgsound&gt;"):"object"==_?(e.MIDIjs.play=function e(n){M();let t=document.getElementById("planetMIDI");t?t.lastChild.setAttribute("data",n):((t=document.createElement("div")).setAttribute("id","planetMIDI"),t.innerHTML='<object data="'+n+'" autostart="true" volume="0" type="audio/mid"></object>',document.body&&document.body.appendChild(t),clearInterval(A),A=setInterval(s,W),N=0,E=t,D("Playing "+n+" ..."))},e.MIDIjs.stop=M,S="audioMethod: &lt;object&gt;"):(e.MIDIjs.play=function(e){},e.MIDIjs.stop=function(e){},S="audioMethod: No method found","Microsoft Internet Explorer"==Q.browserName&&"https:"==location.protocol.toLowerCase()&&setTimeout(function(){g(p(T)+"silence.mid"),clearInterval(A)},1)),ctx=C;var Z={};(-1==location.href.indexOf("local")||"WebAudioAPI"==_)&&(i(T+"pat/arachno-127.pat"),i(T+"pat/MT32Drums/mt32drum-41.pat"),i(x)),e.MIDIjs.initError=null}catch(ee){e.MIDIjs={},e.MIDIjs.initError=ee}}(this);