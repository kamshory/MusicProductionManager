let ctx;!function(e){function n(e,n){for(let t=0;t<document.scripts.length;t++)if(C==document.scripts[t].src){if(z)return n();let r=U.onload;U.onreadystatechange=function(){("loaded"==U.readyState||"complete"==U.readyState)&&(U.onreadystatechange=null,z=!0,r(),n())},U.onload=function(){z=!0,r(),n()}}let o=document.getElementsByTagName("script")[0];(U=document.createElement("script")).onreadystatechange=function(){("loaded"==U.readyState||"complete"==U.readyState)&&(U.onreadystatechange=null,z=!0,n())},U.onload=function(){z=!0,n()},U.onerror=function(){_("Error: Cannot load  JavaScript file "+e)},U.src=e,U.type="text/javascript",o.parentNode.insertBefore(U,o)}function t(e){if(0==(T=Module.ccall("mid_song_read_wave","number",["number","number","number","number"],[S,h,2*P,L])))return I();let n=[];for(let t=0;t<P;t++)t<T?e.outputBuffer.getChannelData(0)[t]=n[t]=Module.getValue(h+2*t,"i16")/32768:e.outputBuffer.getChannelData(0)[t]=n[t]=0;bufVisual=n,0==V&&(V=v.currentTime)}function r(){e.MIDIjs.visualization(bufVisual),J?requestAnimationFrame(r):drawed=!1}function o(e,n,r){let o=new XMLHttpRequest;o.open("GET",n+r,!0),o.responseType="arraybuffer",o.onerror=function(){_("Error: Cannot retrieve patch file "+n+r)},o.onload=function(){if(200!=o.status)return _("Error: Cannot retrieve patch file "+n+r+" : "+o.status);if(k--,FS.createDataFile("pat/",r,new Int8Array(o.response),!0,!0),MIDIjs.message_callback&&k>0&&(MIDIjs.message_callback("Loading Instruments: "+k),_("Loading Instruments: "+k)),0==k){let i=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[x,A.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[v.sampleRate,32784,1,2*P]);S=Module.ccall("mid_song_load","number",["number","number"],[i,s]),Module.ccall("mid_istream_close","number",["number"],[i]),Module.ccall("mid_song_start","void",["number"],[S]),w=v.createScriptProcessor(P,0,1),h=Module._malloc(2*P),w.onaudioprocess=t,w.connect(v.destination),clearInterval(O),O=setInterval(a,W),MIDIjs.message_callback&&MIDIjs.message_callback("Playing MIDI"),_("Playing: "+e+" ...")}},o.send()}function i(e){let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onerror=function(){_("Error: Cannot preload file "+e)},n.onload=function(){if(200!=n.status)return _("Error: Cannot preload file "+e+" : "+n.status)},n.send()}function a(){let n={};n.audioMethod=e.MIDIjs.data.audioMethod,n.isPlaying=J,n.duration=e.MIDIjs.data.duration,0!=V?n.time=v.currentTime-V:n.time=0,n.time>n.duration&&n.duration>1&&(b(),e.MIDIjs.on_ended()),MIDIjs.player_callback&&MIDIjs.player_callback(n)}function s(){let n={};n.audioMethod=e.MIDIjs.data.audioMethod,n.isPlaying=J,n.duration=e.MIDIjs.data.duration,0==V&&(V=(new Date).getTime()),n.time=((new Date).getTime()-V)/1e3,MIDIjs.player_callback&&MIDIjs.player_callback(n)}function u(){if(J=!0,MIDIjs.message_callback("Playing MIDI"),drawed||(r(),drawed=!0),v)return v.resume()}function l(e){v||(window.AudioContext=window.AudioContext||window.webkitAudioContext,v=new AudioContext),v.resume?v.resume().then(c(e)):c(e)}function c(e){return V=0,a(),_("Loading libtimidity ... "),n(C,function(){d(e,m,null)}),F=v.createBuffer(2,3*v.sampleRate,v.sampleRate),(G=v.createBufferSource()).buffer=F,G.connect(v.destination),!0}function d(e,n,t){if(-1!=e.indexOf("data:")){let r=e.indexOf(",")+1,o=atob(e.substring(r));A=new Uint8Array(new ArrayBuffer(o.length));for(let i=0;i<o.length;i++)A[i]=o.charCodeAt(i);return n("data:audio/x-midi ...",A,t)}_("Loading MIDI file "+e+" ..."),t||MIDIjs.message_callback("Loading MIDI");let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onerror=function(){_("Error: Cannot retrieve MIDI file "+e)},a.onload=function(){return 200!=a.status?_("Error: Cannot retrieve MIDI file "+e+" : "+a.status):(_("MIDI file loaded: "+e),n(e,A=new Int8Array(a.response),t))},a.send()}function m(e,n,r){x=Module._malloc(n.length),Module.writeArrayToMemory(n,x),H=Module.ccall("mid_init","number",[],[]);let i=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[x,n.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[v.sampleRate,32784,1,2*P]);if(S=Module.ccall("mid_song_load","number",["number","number"],[i,s]),H=Module.ccall("mid_istream_close","number",["number"],[i]),0<(k=Module.ccall("mid_song_get_num_missing_instruments","number",["number"],[S])))for(let u=0;u<k;u++)o(e,N+"pat/",Module.ccall("mid_song_get_missing_instrument","string",["number","number"],[S,u]));else Module.ccall("mid_song_start","void",["number"],[S]),w=v.createScriptProcessor(P,0,1),h=Module._malloc(2*P),w.onaudioprocess=t,w.connect(v.destination),clearInterval(O),O=setInterval(a,W),MIDIjs.message_callback&&MIDIjs.message_callback("Playing MIDI"),_("Playing: "+e+" ...");f(e,n,r)}function f(n,t,r){let o=Module._malloc(t.length);Module.writeArrayToMemory(t,o);let i=(Module.ccall("mid_init","number",[],[]),Module.ccall("mid_istream_open_mem","number",["number","number","number"],[o,t.length,!1])),a=Module.ccall("mid_create_options","number",["number","number","number","number"],[44100,32784,1,2*P]),s=Module.ccall("mid_song_load","number",["number","number"],[i,a]),u=(Module.ccall("mid_istream_close","number",["number"],[i]),Module.ccall("mid_song_get_total_time","number",["number"],[s])/1e3);e.MIDIjs.data.duration=u,e.MIDIjs.on_song_loaded(i,32784,a,s,u),Module.ccall("mid_song_free","void",["number"],[s]),Module._free(o),r&&r(u)}function I(){w&&(w.disconnect(),w.onaudioprocess=0,w=0),S&&(Module._free(h),Module._free(x),Module.ccall("mid_song_free","void",["number"],[S]),S=0)}function b(){J=!1,MIDIjs.message_callback("Stoped"),I(),clearInterval(O),_(B)}function p(e){var n;return -1!=e.indexOf("http:")?e:(n=e,void 0===E&&(E=document.createElement("a")),E.href=n,E.href).replace("https:","http:")}function g(e){M();let n=p(e),t=document.getElementById("planetMIDI");t?t.lastChild.setAttribute("src",n):((t=document.createElement("div")).setAttribute("id","planetMIDI"),t.innerHTML='&nbsp;<bgsound src="'+n+'" volume="0"/>',document.body&&document.body.appendChild(t)),clearInterval(O),O=setInterval(s,W),V=0,w=t,_("Playing "+n+" ...")}function M(){w&&(w.lastChild.setAttribute("src",p(N)+"silence.mid"),clearInterval(O),w=0),_(B)}function $(){if(w){let e=w;e.parentNode.removeChild(e),clearInterval(O),w=0}_(B)}function D(){return G}function j(){return v}function _(e){R&&console.log(e)}var y,h,x,A,C,E,O,v=null,w=0,P=8192,k=0,T=0,S=0,N="",V=0,B="",L=!1,R=!1,W=10,z=!1,F=null,G=null,H=null,J=!1,U=null;try{e.MIDIjs={},e.MIDIjs.data={},e.MIDIjs.initError="initializing ...",C=(N=function e(){for(let n=0;n<document.scripts.length;n++){let t=document.scripts[n].src;if(t.lastIndexOf("/midi.min.js")>-1){let r=t.split("/");return r.pop(),r.join("/")+"/"}}for(let o=0;o<document.scripts.length;o++){let i=document.scripts[o].src;if(i.lastIndexOf("/midi.js")>-1){let a=i.split("/");return a.pop(),a.join("/")+"/"}}return null}())+"libtimidity.min.js";let q,K,Q,X,Y,Z,ee,en,et=(X=navigator.userAgent,Y=navigator.appName,Z=""+parseFloat(navigator.appVersion),ee=parseInt(navigator.appVersion,10),-1!=X.indexOf("Opera")?(Y="Opera",Z=X.substring(K+6),-1!=X.indexOf("Version")&&(Z=X.substring(K+8))):-1!=X.indexOf("MSIE")?(Y="Microsoft Internet Explorer",Z=X.substring(K+5)):-1!=X.indexOf("Trident")?(Y="Microsoft Internet Explorer",Z=-1!=X.indexOf("rv:")?X.substring(K+3):"0.0"):-1!=X.indexOf("Chrome")?(Y="Chrome",Z=X.substring(K+7)):-1!=X.indexOf("Android")?(Y="Android",Z=X.substring(K+8)):-1!=X.indexOf("Safari")?(Y="Safari",Z=X.substring(K+7),-1!=X.indexOf("Version")&&(Z=X.substring(K+8))):-1!=X.indexOf("Firefox")?(Y="Firefox",Z=X.substring(K+8)):X.lastIndexOf(" ")+1<X.lastIndexOf("/")&&(q=X.lastIndexOf(" ")+1,Y=X.substring(K,q),Z=X.substring(K+1),Y.toLowerCase()==Y.toUpperCase()&&(Y=navigator.appName,-1!=(Q=Z.indexOf(";"))&&(Z=Z.substring(0,Q)),-1!=(Q=Z.indexOf(" "))&&(Z=Z.substring(0,Q)),-1!=(Q=Z.indexOf(")"))&&(Z=Z.substring(0,Q)),isNaN(ee=parseInt(""+Z,10))&&(Z=""+parseFloat(navigator.appVersion)),ee=parseInt(navigator.appVersion,10))),(en={}).browserName=Y,en.fullVersion=Z,en.majorVersion=ee,en.appName=navigator.appName,en.userAgent=navigator.userAgent,en.platform=navigator.platform,en);try{("iPhone"==et.platform||"iPod"==et.platform||"iPad"==et.platform)&&et.majorVersion<=6?y="none":(window.AudioContext=window.AudioContext||window.webkitAudioContext,v=new AudioContext,y="WebAudioAPI")}catch(er){y="Microsoft Internet Explorer"==et.browserName?"bgsound":"Android"==et.browserName?"none":"object"}e.MIDIjs.data.duration=0,e.MIDIjs.data.audioMethod=y,e.MIDIjs.setPlayingTime=function(){},e.MIDIjs.getAudioContext=function(){},e.MIDIjs.on_ended=function(){},e.MIDIjs.set_logging=function(e){R=e},e.MIDIjs.get_loggging=function(){return R},e.MIDIjs.player_callback=function(e){},e.MIDIjs.message_callback=function(e){},e.MIDIjs.get_audio_status=function(){return B},e.MIDIjs.getSource=function(){},e.MIDIjs.visualization=function(e){},e.MIDIjs.get_duration=function(e,t){"Microsoft Internet Explorer"==et.browserName&&et.fullVersion<10?t&&t(-1):n(C,function(){d(e,f,t)})},e.MIDIjs.pause=function(){},e.MIDIjs.resume=function(){},e.MIDIjs.resumeWebAudioContext=function(){},e.MIDIjs.on_song_loaded=function(){},"WebAudioAPI"==y?(e.MIDIjs.resumeWebAudioContext=u,e.MIDIjs.pause=function e(){J=!1,drawed=!1,MIDIjs.message_callback("Paused"),v&&v.suspend()},e.MIDIjs.resume=u,e.MIDIjs.play=function n(t){b(),L=!1,J=!0,P=8192,l(t),e.MIDIjs.data.duration>1&&(clearInterval(O),O=setInterval(a,W)),drawed||(r(),drawed=!0)},e.MIDIjs.stop=b,e.MIDIjs.setPlayingTime=function e(n,t,r){},e.MIDIjs.getAudioContext=j,B="audioMethod: WebAudioAPI, sampleRate (Hz): "+v.sampleRate+", audioBufferSize (Byte): "+P,e.MIDIjs.noteOn=function e(n,t,r){L||(J=!0,P=512,l(N+"initsynth.midi")),0!=S&&Module.ccall("mid_song_note_on","void",["number","number","number","number"],[S,n,t,r])},e.MIDIjs.startSynth=function e(){MIDIjs.noteOn(0,60,0)},e.MIDIjs.seek=function e(n){"undefined"!=typeof Module&&(Module.ccall("skip_to","void",["number","number"],[S,n*v.sampleRate]),V=v.currentTime-n)},e.MIDIjs.getSource=D):"bgsound"==y?(e.MIDIjs.play=g,e.MIDIjs.stop=M,B="audioMethod: &lt;bgsound&gt;"):"object"==y?(e.MIDIjs.play=function e(n){$();let t=document.getElementById("planetMIDI");t?t.lastChild.setAttribute("data",n):((t=document.createElement("div")).setAttribute("id","planetMIDI"),t.innerHTML='<object data="'+n+'" autostart="true" volume="0" type="audio/mid"></object>',document.body&&document.body.appendChild(t),clearInterval(O),O=setInterval(s,W),V=0,w=t,_("Playing "+n+" ..."))},e.MIDIjs.stop=$,B="audioMethod: &lt;object&gt;"):(e.MIDIjs.play=function(e){},e.MIDIjs.stop=function(e){},B="audioMethod: No method found","Microsoft Internet Explorer"==et.browserName&&"https:"==location.protocol.toLowerCase()&&setTimeout(function(){g(p(N)+"silence.mid"),clearInterval(O)},1)),ctx=v,(-1==location.href.indexOf("local")||"WebAudioAPI"==y)&&(i(N+"pat/arachno-127.pat"),i(N+"pat/MT32Drums/mt32drum-41.pat"),i(C)),e.MIDIjs.initError=null}catch(eo){e.MIDIjs={},e.MIDIjs.initError=eo}}(this);