!function(e){function n(e,n){for(var r=0;r<document.scripts.length;r++)if(D==document.scripts[r].src){if(U)return void n();var t=newjs.onload;return newjs.onreadystatechange=function(){"loaded"!==newjs.readyState&&"complete"!==newjs.readyState||(newjs.onreadystatechange=null,U=!0,t(),n())},void(newjs.onload=function(){U=!0,t(),n()})}var o=document.getElementsByTagName("script")[0];(newjs=document.createElement("script")).onreadystatechange=function(){"loaded"!==newjs.readyState&&"complete"!==newjs.readyState||(newjs.onreadystatechange=null,U=!0,n())},newjs.onload=function(){U=!0,n()},newjs.onerror=function(){v("Error: Cannot load  JavaScript file "+e)},newjs.src=e,newjs.type="text/javascript",o.parentNode.insertBefore(newjs,o)}function r(e){if(0==(L=Module.ccall("mid_song_read_wave","number",["number","number","number","number"],[W,h,2*V,G])))return void m();for(var n=0;n<V;n++)n<L?e.outputBuffer.getChannelData(0)[n]=Module.getValue(h+2*n,"i16")/32768:e.outputBuffer.getChannelData(0)[n]=0;0==z&&(z=N.currentTime)}function t(e,n,t){var o=new XMLHttpRequest;o.open("GET",n+t,!0),o.responseType="arraybuffer",o.onerror=function(){v("Error: Cannot retrieve patch file "+n+t)},o.onload=function(){if(200!=o.status)return void v("Error: Cannot retrieve patch file "+n+t+" : "+o.status);if(B--,FS.createDataFile("pat/",t,new Int8Array(o.response),!0,!0),MIDIjs.messageCallback&&B>0&&MIDIjs.messageCallback("Instruments to be loaded: "+B),v("Instruments to be loaded: "+B),0==B){var a=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[_,y.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[N.sampleRate,32784,1,2*V]);W=Module.ccall("mid_song_load","number",["number","number"],[a,s]),Module.ccall("mid_istream_close","number",["number"],[a]),Module.ccall("mid_song_start","void",["number"],[W]),S=N.createScriptProcessor(V,0,1),h=Module._malloc(2*V),S.onaudioprocess=r,S.connect(N.destination),j=setInterval(i,J),MIDIjs.messageCallback&&MIDIjs.messageCallback("Playing: "+e),v("Playing: "+e+" ...")}},o.send()}function o(e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onerror=function(){v("Error: Cannot preload file "+e)},n.onload=function(){if(200!=n.status)return void v("Error: Cannot preload file "+e+" : "+n.status)},n.send()}function i(){var e={};0!=z?e.time=N.currentTime-z:e.time=0,MIDIjs.playerCallback&&MIDIjs.playerCallback(e)}function a(){if(N&&N.resume)return N.resume()}function s(e){N||(window.AudioContext=window.AudioContext||window.webkitAudioContext,N=new AudioContext),N.resume?N.resume().then(u(e)):u(e)}function u(e){z=0,i(),v("Loading libtimidity ... "),n(D,function(){l(e,c,null)})}function l(e,n,r){if(-1!=e.indexOf("data:")){var t=e.indexOf(",")+1,o=atob(e.substring(t));y=new Uint8Array(new ArrayBuffer(o.length));for(var i=0;i<o.length;i++)y[i]=o.charCodeAt(i);return n("data:audio/x-midi ...",y,r)}v("Loading MIDI file "+e+" ..."),r||MIDIjs.messageCallback("Loading MIDI file "+e+" ...");var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onerror=function(){v("Error: Cannot retrieve MIDI file "+e)},a.onload=function(){return 200!=a.status?void v("Error: Cannot retrieve MIDI file "+e+" : "+a.status):(v("MIDI file loaded: "+e),n(e,y=new Int8Array(a.response),r))},a.send()}function c(e,n,o){_=Module._malloc(n.length),Module.writeArrayToMemory(n,_),rval=Module.ccall("mid_init","number",[],[]);var a=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[_,n.length,!1]),s=Module.ccall("mid_create_options","number",["number","number","number","number"],[N.sampleRate,32784,1,2*V]);if(W=Module.ccall("mid_song_load","number",["number","number"],[a,s]),rval=Module.ccall("mid_istream_close","number",["number"],[a]),0<(B=Module.ccall("mid_song_get_num_missing_instruments","number",["number"],[W])))for(var u=0;u<B;u++)t(e,R+"pat/",Module.ccall("mid_song_get_missing_instrument","string",["number","number"],[W,u]));else Module.ccall("mid_song_start","void",["number"],[W]),S=N.createScriptProcessor(V,0,1),h=Module._malloc(2*V),S.onaudioprocess=r,S.connect(N.destination),j=setInterval(i,J),MIDIjs.messageCallback&&MIDIjs.messageCallback("Playing: "+e),v("Playing: "+e+" ...")}function m(){S&&(S.disconnect(),S.onaudioprocess=0,S=0),W&&(Module._free(h),Module._free(_),Module.ccall("mid_song_free","void",["number"],[W]),W=0)}function d(){m(),clearInterval(j),v(F)}function f(e){var n;return -1!=e.indexOf("http:")?e:(n=e,void 0===x&&(x=document.createElement("a")),x.href=n,x.href).replace("https:","http:")}function b(){var e={};0==z&&(z=(new Date).getTime()),e.time=((new Date).getTime()-z)/1e3,MIDIjs.playerCallback&&MIDIjs.playerCallback(e)}function p(e){g(),url=f(e);var n=document.getElementById("scorioMIDI");n?n.lastChild.setAttribute("src",url):((n=document.createElement("div")).setAttribute("id","scorioMIDI"),n.innerHTML='&nbsp;<bgsound src="'+url+'" volume="0"/>',document.body&&document.body.appendChild(n)),j=setInterval(b,J),z=0,S=n,v("Playing "+url+" ...")}function g(){S&&(S.lastChild.setAttribute("src",f(R)+"silence.mid"),clearInterval(j),S=0),v(F)}function I(){if(S){var e=S;e.parentNode.removeChild(e),clearInterval(j),S=0}v(F)}function $(e,n,r){var t=Module._malloc(n.length);Module.writeArrayToMemory(n,t);var o=(Module.ccall("mid_init","number",[],[]),Module.ccall("mid_istream_open_mem","number",["number","number","number"],[t,n.length,!1])),i=Module.ccall("mid_create_options","number",["number","number","number","number"],[44100,32784,1,2*V]),a=Module.ccall("mid_song_load","number",["number","number"],[o,i]),s=(Module.ccall("mid_istream_close","number",["number"],[o]),Module.ccall("mid_song_get_total_time","number",["number"],[a])/1e3);Module.ccall("mid_song_free","void",["number"],[a]),Module._free(t),r&&r(s)}function v(e){H&&console.log(e)}try{e.MIDIjs={},e.MIDIjs.initError="initializing ...";var M,h,_,y,D,x,j,A,C,O,E,w,T,k,P,N=null,S=0,V=8192,B=0,L=0,W=0,R="",z=0,F="",G=!1,H=!1,J=100,U=!1;D=(R=function e(){for(var n=0;n<document.scripts.length;n++){var r=document.scripts[n].src,t=r.lastIndexOf("/midi.min.js");if(t==r.length-8)return r.substr(0,t+1)}for(var n=0;n<document.scripts.length;n++){var r=document.scripts[n].src,t=r.lastIndexOf("/midi.js");if(t==r.length-8)return r.substr(0,t+1)}return null}())+"libtimidity.min.js";var q=(E=navigator.userAgent,w=navigator.appName,T=""+parseFloat(navigator.appVersion),k=parseInt(navigator.appVersion,10),-1!=(C=E.indexOf("Opera"))?(w="Opera",T=E.substring(C+6),-1!=(C=E.indexOf("Version"))&&(T=E.substring(C+8))):-1!=(C=E.indexOf("MSIE"))?(w="Microsoft Internet Explorer",T=E.substring(C+5)):-1!=(C=E.indexOf("Trident"))?(w="Microsoft Internet Explorer",T=-1!=(C=E.indexOf("rv:"))?E.substring(C+3):"0.0"):-1!=(C=E.indexOf("Chrome"))?(w="Chrome",T=E.substring(C+7)):-1!=(C=E.indexOf("Android"))?(w="Android",T=E.substring(C+8)):-1!=(C=E.indexOf("Safari"))?(w="Safari",T=E.substring(C+7),-1!=(C=E.indexOf("Version"))&&(T=E.substring(C+8))):-1!=(C=E.indexOf("Firefox"))?(w="Firefox",T=E.substring(C+8)):(A=E.lastIndexOf(" ")+1)<(C=E.lastIndexOf("/"))&&(w=E.substring(A,C),T=E.substring(C+1),w.toLowerCase()==w.toUpperCase()&&(w=navigator.appName)),-1!=(O=T.indexOf(";"))&&(T=T.substring(0,O)),-1!=(O=T.indexOf(" "))&&(T=T.substring(0,O)),-1!=(O=T.indexOf(")"))&&(T=T.substring(0,O)),isNaN(k=parseInt(""+T,10))&&(T=""+parseFloat(navigator.appVersion),k=parseInt(navigator.appVersion,10)),(P={}).browserName=w,P.fullVersion=T,P.majorVersion=k,P.appName=navigator.appName,P.userAgent=navigator.userAgent,P.platform=navigator.platform,P);try{("iPhone"==q.platform||"iPod"==q.platform||"iPad"==q.platform)&&q.majorVersion<=6?M="none":(window.AudioContext=window.AudioContext||window.webkitAudioContext,N=new AudioContext,M="WebAudioAPI")}catch(K){M="Microsoft Internet Explorer"==q.browserName?"bgsound":"Android"==q.browserName?"none":"object"}e.MIDIjs.set_logging=function(e){H=e},e.MIDIjs.get_loggging=function(){return H},e.MIDIjs.playerCallback=function(e){},e.MIDIjs.messageCallback=function(e){},e.MIDIjs.get_audio_status=function(){return F},e.MIDIjs.get_duration=function(e,r){"Microsoft Internet Explorer"==q.browserName&&q.fullVersion<10?r&&r(-1):n(D,function(){l(e,$,r)})},e.MIDIjs.pause=function(){},e.MIDIjs.resume=function(){},e.MIDIjs.resumeWebAudioContext=function(){},e.MIDIjs.setCurrentTime=function(e){var n;n=e,N&&(N.currentTime=n)},"WebAudioAPI"==M?(e.MIDIjs.resumeWebAudioContext=a,e.MIDIjs.pause=function e(){N&&N.suspend()},e.MIDIjs.resume=a,e.MIDIjs.play=function e(n){d(),G=!1,V=8192,s(n)},e.MIDIjs.stop=d,F="audioMethod: WebAudioAPI, sampleRate (Hz): "+N.sampleRate+", audioBufferSize (Byte): "+V,e.MIDIjs.noteOn=function e(n,r,t){G||(G=!0,V=512,s(R+"../midi/initsynth.midi")),0!=W&&Module.ccall("mid_song_note_on","void",["number","number","number","number"],[W,n,r,t])},e.MIDIjs.startSynth=function e(){MIDIjs.noteOn(0,60,0)}):"bgsound"==M?(e.MIDIjs.play=p,e.MIDIjs.stop=g,F="audioMethod: &lt;bgsound&gt;"):"object"==M?(e.MIDIjs.play=function e(n){I();var r=document.getElementById("scorioMIDI");r?r.lastChild.setAttribute("data",n):((r=document.createElement("div")).setAttribute("id","scorioMIDI"),r.innerHTML='<object data="'+n+'" autostart="true" volume="0" type="audio/mid"></object>',document.body&&document.body.appendChild(r)),j=setInterval(b,J),z=0,S=r,v("Playing "+n+" ...")},e.MIDIjs.stop=I,F="audioMethod: &lt;object&gt;"):(e.MIDIjs.play=function(e){},e.MIDIjs.stop=function(e){},F="audioMethod: No method found"),"Microsoft Internet Explorer"==q.browserName&&"https:"==location.protocol.toLowerCase()&&setTimeout(function(){p(f(R)+"silence.mid"),clearInterval(j)},1),-1==location.href.indexOf("scorio.com")&&-1==location.href.indexOf("weblily.net")&&-1==location.href.indexOf("local")||"WebAudioAPI"==M&&(o(R+"pat/arachno-127.pat"),o(R+"pat/MT32Drums/mt32drum-41.pat"),o(D)),e.MIDIjs.initError=null}catch(Q){e.MIDIjs={},e.MIDIjs.initError=Q}}(this);